<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>
	<body style="background: #fff;">
		<script src="js/mui.min.js"></script>
		<script src="js/jquery-2.1.0.js"></script>
		<script src="js/base64.js"></script>
		<script type="text/javascript" src="js/md5.js"></script>
		<script type="text/javascript">
			mui.init()
		</script>
		<header class="mui-bar mui-bar-nav" style="background: #69e2b9;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #fff;"></a>
			<h1 class="mui-title" style="color: #fff;font-weight: bold;font-size: 20px;">答题卡</h1>
		</header>
		<div class="mui-content" id="tableData" style="margin-bottom: 40px;">
			<div class="mui-card" style="margin: 0;box-shadow: none;">
				<ul class="mui-table-view" id="datika">
					<li class="mui-table-view-cell nm1" style="font-size:18px;color: #6d6d6d;font-weight: bold;">单项填空</li>
					<div class="line" style="border-top: 1px solid #f5f5f5;width: 90%;margin: 0 auto;margin-bottom: 6px;"></div>
					</ul>
				<ul class="mui-table-view" id="wanxing">
					<li class="mui-table-view-cell nm1" style="font-size: 18px;color: #6d6d6d;font-weight: bold;">完形填空</li>
					<div class="line" style="border-top: 1px solid #f5f5f5;width: 90%;margin: 0 auto;margin-bottom: 6px;"></div>
				</ul>
				<ul class="mui-table-view" id="yuedu">
					<li class="mui-table-view-cell nm1" style="font-size: 18px;color: #6d6d6d;font-weight: bold;">阅读理解</li>
					<div class="line" style="border-top: 1px solid #f5f5f5;width: 90%;margin: 0 auto;margin-bottom: 6px;"></div>
				</ul>
				<ul class="mui-table-view" id="renwuxing">
					<li class="mui-table-view-cell nm1" style="font-size: 18px;color: #6d6d6d;font-weight: bold;">任务型阅读</li>
					<div class="line" style="border-top: 1px solid #f5f5f5;width: 90%;margin: 0 auto;margin-bottom: 6px;"></div>
					
		
				</ul>
			</div>
			<div class="mui-part4 mui-bar mui-bar-tab">
				<ul class="mui-table-view" style="height: 53px;">
					<li class="mui-table-view-cell" id="baocun" style="float: left;font-size:16px;width: 37%;color: #333;text-align: center;margin-left: 15%;" ><span style="float: left;"><img src="images/baocun.png" style="width: 20px;margin-top: 6px;"></span>
						<div style="float: left;margin-left: 10px;margin-top: 8px;font-size: 16px;color: #f4aa31;">保&nbsp;存</div>
					</li>
					<li class="mui-table-view-cell" id="tijiao" style="float: left;font-size: 16px;color: #333;width: 37%;text-align: center; " onclick="getVals();"><span style="float: left;margin-top: 3px;"><img src="images/tijiao.png" style="width: 20px;margin-top: 6px"></span>
						<div style="float: left;margin-left: 10px;margin-top: 8px;font-size: 16px;color: #0978be;">提&nbsp;交</div>
					</li>
				</ul>
			</div>
		</div>
	</body>
	<script type="text/template">
		<li class="mui-table-view-cell nm1" style="padding-top: 0px;padding-bottom: 0px;">
			<div class="xuhao" style="float: left;margin-left: 2px;margin-top: 8px;font-size: 15px;" id="{sub_qp_id}">{sub_qp_seq}、</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >A</label>
				<input name="{sub_qp_id}" type="radio" value="A" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >B</label>
				<input name="{sub_qp_id}" type="radio" value="B" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >C</label>
				<input name="{sub_qp_id}" type="radio" value="C" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >D</label>
				<input name="{sub_qp_id}" type="radio" value="D" class="rds" id="{sub_qp_seq}">
			</div>

		</li>
	</script>

	<script type="text/html" id="panduan1">
		<li class="mui-table-view-cell nm1" style="padding-top: 0px;padding-bottom: 0px;">
			<div class="xuhao" style="float: left;margin-left: 2px;margin-top: 8px;font-size: 15px;" id="{sub_qp_id}">{sub_qp_seq}、</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 21%;">
				<label >A</label>
				<input name="{sub_qp_id}" type="radio" value="A" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 21%;">
				<label >B</label>
				<input name="{sub_qp_id}" type="radio" value="B" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 21%;">
				<label >C</label>
				<input name="{sub_qp_id}" type="radio" value="C" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 21%;">
				<label >D</label>
				<input name="{sub_qp_id}" type="radio" value="D" class="rds" id="{sub_qp_seq}">
			</div>

		</li>
	</script>
	<script type="text/html" id="yuedu1">
		<li class="mui-table-view-cell nm1" style="padding-top: 0px;padding-bottom: 0px;">
			<div class="xuhao" style="float: left;margin-left: 2px;margin-top: 8px;font-size: 15px;" id="{sub_qp_id}">{sub_qp_seq}、</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >A</label>
				<input name="{sub_qp_id}" type="radio" value="A" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >B</label>
				<input name="{sub_qp_id}" type="radio" value="B" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >C</label>
				<input name="{sub_qp_id}" type="radio" value="C" class="rds" id="{sub_qp_seq}">
			</div>
			<div class="mui-input-row mui-radio" style="float: left;clear: none;width: 22%;">
				<label >D</label>
				<input name="{sub_qp_id}" type="radio" value="D" class="rds" id="{sub_qp_seq}">
			</div>

		</li>
	</script>
	
	<script type="text/html" id="renwuxing1">
		<li class="mui-table-view-cell nm1" style="padding-top: 0px;padding-bottom: 0px;">
			<div class="xuhao" style="float: left;margin-left: 2px;margin-top: 8px;font-size: 15px;" id="{sub_qp_id}">{sub_qp_seq}、</div>
			<div class="mui-input-row" style="float: left;clear: none;width: 80%;">
				<input type="text" class="inputs" placeholder="输入答案" name="{sub_qp_id}"  style="float: right;width: 100%;margin-bottom: 0;padding-left: 0;border: 0;">
			</div>
		

		</li>
	</script>
	
	
	<script>
		
		mui.init({
			swipeBack: true,
			keyEventBind: {
				backbutton: false, //Boolean(默认true)关闭back按键监听
				menubutton: false //Boolean(默认true)关闭menu按键监听
			},
		});
		mui.plusReady(function() {
		
			plus.navigator.setStatusBarBackground('#69e2b9');

			function formatTemplate(data, tmpl) {
				var format = {
					name: function(x) {
						return x;
					}
				};
				return tmpl.replace(/{(\w+)}/g, function(m1, m2) {
					if(!m2)
						return "";
					return(format && format[m2]) ? format[m2](data[m2]) : data[m2];
				});
			}
			var jid = localStorage.jid;
			var tou = localStorage.token
			console.log(jid)
			console.log(tou)
			mui.ajax(`${sever}xgt_sub_qp/getDanxuan`, {
				data: {
					'subexamId': jid
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					'Authorization': "" + 'Bearer ' + tou + ""
				},
				success: function(data) {

					console.log(JSON.stringify(data))

					if(!data || !data || data.length <= 0) {
						return;
					}

					//获取模板上的HTML  
					var html = $('script[type="text/template"]').html();
					//定义一个数组，用来接收格式化合的数据  
					var arr = [];
					//对数据进行遍历  
					$.each(data, function(i, o) {
						o.lie_shu = JSON.stringify(i + 1)
						o.name = 'zzz' + o.sub_qp_id
						//这里取到o就是上面rows数组中的值, formatTemplate是最开始定义的方法.  
						arr.push(formatTemplate(o, html));
					});
					//好了，最后把数组化成字符串，并添加到table中去。  
					$('#datika').append(arr.join(''));

				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					console.log(type);
				}
			});
//完型填空
			function formatTemplate(dta, tmpl) {
				var format = {
					name: function(x) {
						return x;
					}
				};
				return tmpl.replace(/{(\w+)}/g, function(m1, m2) {
					if(!m2)
						return "";
					return(format && format[m2]) ? format[m2](dta[m2]) : dta[m2];
				});
			}
			var jid = localStorage.jid;
			var tou = localStorage.token
			console.log(jid)
			console.log(tou)
			mui.ajax(`${sever}xgt_sub_qp/getWanxing`, {
				data: {
					'subexamId': jid
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					'Authorization': "" + 'Bearer ' + tou + ""
				},
				success: function(data) {
					console.log(JSON.stringify(data))

					if(!data || !data || data.length <= 0) {
						return;
					}

					//获取模板上的HTML  
					var html = $('#panduan1').html();
					//定义一个数组，用来接收格式化合的数据  
					var arr = [];
					//对数据进行遍历  
					$.each(data, function(i, o) {
						o.lie_shu = JSON.stringify(i + 1)
						//这里取到o就是上面rows数组中的值, formatTemplate是最开始定义的方法.  
						arr.push(formatTemplate(o, html));
					});
					//好了，最后把数组化成字符串，并添加到table中去。  
					$('#wanxing').append(arr.join(''));

				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					console.log(type);
				}
			});
			
			//阅读理解
			function formatTemplate(dta, tmpl) {
				var format = {
					name: function(x) {
						return x;
					}
				};
				return tmpl.replace(/{(\w+)}/g, function(m1, m2) {
					if(!m2)
						return "";
					return(format && format[m2]) ? format[m2](dta[m2]) : dta[m2];
				});
			}
			var jid = localStorage.jid;
			var tou = localStorage.token
			console.log(jid)
			console.log(tou)
			mui.ajax(`${sever}xgt_sub_qp/getYuedu`, {
				data: {
					'subexamId': jid
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					'Authorization': "" + 'Bearer ' + tou + ""
				},
				success: function(data) {
					console.log(JSON.stringify(data))

					if(!data || !data || data.length <= 0) {
						return;
					}

					//获取模板上的HTML  
					var html = $('#yuedu1').html();
					//定义一个数组，用来接收格式化合的数据  
					var arr = [];
					//对数据进行遍历  
					$.each(data, function(i, o) {
						o.lie_shu = JSON.stringify(i + 1)
						//这里取到o就是上面rows数组中的值, formatTemplate是最开始定义的方法.  
						arr.push(formatTemplate(o, html));
					});
					//好了，最后把数组化成字符串，并添加到table中去。  
					$('#yuedu').append(arr.join(''));

				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					console.log(type);
				}
			});
			//任务型阅读
			function formatTemplate(dta, tmpl) {
				var format = {
					name: function(x) {
						return x;
					}
				};
				return tmpl.replace(/{(\w+)}/g, function(m1, m2) {
					if(!m2)
						return "";
					return(format && format[m2]) ? format[m2](dta[m2]) : dta[m2];
				});
			}
			var jid = localStorage.jid;
			var tou = localStorage.token
			console.log(jid)
			console.log(tou)
			mui.ajax(`${sever}xgt_sub_qp/getRenwu`, {
				data: {
					'subexamId': jid
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					'Authorization': "" + 'Bearer ' + tou + ""
				},
				success: function(data) {
					console.log(JSON.stringify(data))

					if(!data || !data || data.length <= 0) {
						return;
					}

					//获取模板上的HTML  
					var html = $('#renwuxing1').html();
					//定义一个数组，用来接收格式化合的数据  
					var arr = [];
					//对数据进行遍历  
					$.each(data, function(i, o) {
						o.lie_shu = JSON.stringify(i + 1)
						//这里取到o就是上面rows数组中的值, formatTemplate是最开始定义的方法.  
						arr.push(formatTemplate(o, html));
					});
					//好了，最后把数组化成字符串，并添加到table中去。  
					$('#renwuxing').append(arr.join(''));

				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					console.log(type);
				}
			});

		})
		window.addEventListener('refresh', function(e) { //执行刷新  

			location.reload();

		})
	</script>
	<script>
		var jsonArray = [];
		var	inputjsonArray =[];
		var arrid = new Array();
		var cishu  =  null
		function getRadioRes(className) {
			
			
		}
		
		
		
		function getVals() {
			var wancheng=localStorage.wancheng
			console.log(wancheng)
			if (wancheng==3){
				mui.toast('已提交，请勿重复提交');
			}else{
				
			var intarr = [];	
			var intarr1 = [];
			 var inputs = document.getElementsByClassName('inputs');
					console.log(JSON.stringify(inputs))
					console.log(JSON.stringify(inputs.length))
				var inputval = null;
			  var inputname = null;
			for(i = 0; i < inputs.length; i++) {
				
					inputval = inputs[i].value;
					inputname = inputs[i].name;
					
					intarr.push(inputval)
					intarr1.push(inputname)
	
			}
				
				console.log(JSON.stringify(intarr))
				console.log(JSON.stringify(intarr1))
				for(var i = 0; i < intarr1.length; i++) {
				var inputjson = {};
				for(var j = 0; j < intarr.length; j++) {
					if(i == j) {
						inputjson.sub_qp_id = intarr1[i];
						inputjson.user_ask = intarr[j];
						inputjsonArray.push(inputjson);
					}
				}
			}
				
				
				
				
				
				
				
			Date.prototype.format = function (format) {
           var args = {
               "M+": this.getMonth() + 1,
               "d+": this.getDate(),
               "h+": this.getHours(),
               "m+": this.getMinutes(),
               "s+": this.getSeconds(),
               "q+": Math.floor((this.getMonth() + 3) / 3),  //quarter
               "S": this.getMilliseconds()
           };
           if (/(y+)/.test(format))
               format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
           for (var i in args) {
               var n = args[i];
               if (new RegExp("(" + i + ")").test(format))
                   format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? n : ("00" + n).substr(("" + n).length));
           }
           return format;
       };
			var myDate = new Date().format("yyyy-MM-dd hh:mm:ss");
			localStorage.setItem('myDate',myDate)
          var arr = new Array();
			var rdsObj = document.getElementsByClassName('rds');
			console.log(JSON.stringify(rdsObj))
			console.log(rdsObj.length)
			cishu=rdsObj.length/4
			console.log(cishu)
			var chackVal = null;
			var zzzname = null;
			for(i = 0; i < rdsObj.length; i++) {
				if(rdsObj[i].checked) {
					chackVal = rdsObj[i].value;
					zzzname = rdsObj[i].name;
					order = rdsObj[i].id;
					arr.push(chackVal)
					arrid.push(zzzname)
				}
			}
			console.log(arr)
			if(cishu !== arr.length&&intarr.length!==inputs.length) {
				mui.toast('请选择');
				return false;
			}else{
			
console.log(arr.length)
			for(var i = 0; i < arrid.length; i++) {
				var json = {};
				for(var j = 0; j < arr.length; j++) {
					if(i == j) {
						json.sub_qp_id = arrid[i];
						json.user_ask = arr[j];
						jsonArray.push(json);
					}
				}
			}		

			var zzzz={}
			var userId=localStorage.ID
			var task_obj_id=localStorage.task_obj_id
			var myDate=localStorage.myDate
			zzzz['userId']=userId
			zzzz['jsonArray']=jsonArray
			zzzz['task_obj_id']=task_obj_id
			zzzz['myDate']=myDate
			zzzz['inputjsonArray']=inputjsonArray
			var bianma = Base64.encode(JSON.stringify(zzzz));
			var suiji = md5(bianma + localStorage.randomKey);
			var DATA = {
					'object': bianma,
					'sign': suiji
			}
			var tou = localStorage.token
			mui.ajax(`${sever}xgt_sub_task_dtl/add`, {
				data:JSON.stringify(DATA),
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				headers: {
					'Content-Type': 'application/json',
					'Authorization': "" + 'Bearer ' + tou + ""
				},
				success: function(data) {
					var myDate=localStorage.myDate
					console.log(myDate)
					mui.openWindow({
					id: 'daan.html',
					url: 'daan.html'
				})
				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					console.log(type);
				}
			});
			console.log(JSON.stringify(jsonArray))}
			
			
			
			
			
			
			
			
		}
			
		}
		
		
		
		window.addEventListener('refresh', function(e) { //执行刷新  

	location.reload();

})
	</script>

</html>